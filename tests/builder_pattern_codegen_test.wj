// Test: Builder pattern methods should generate correct self parameter
// Builder pattern: Take mut self, modify field, return self
//
// Bug: Compiler generates methods WITHOUT self parameter when it should
// detect builder pattern (mutates field AND returns Self)

pub struct Config {
    pub name: String,
    pub timeout: i32,
    pub retries: i32,
}

impl Config {
    // Constructor - no self parameter needed
    pub fn new() -> Config {
        Config {
            name: String::new(),
            timeout: 30,
            retries: 3,
        }
    }

    // Builder pattern - should generate: pub fn name(mut self, name: String) -> Config
    // Currently generates: pub fn name(name: String) -> Config  (MISSING self!)
    pub fn name(self, name: String) -> Config {
        self.name = name
        self
    }

    // Builder pattern - should generate: pub fn timeout(mut self, timeout: i32) -> Config
    pub fn timeout(self, timeout: i32) -> Config {
        self.timeout = timeout
        self
    }

    // Builder pattern - should generate: pub fn retries(mut self, retries: i32) -> Config
    pub fn retries(self, retries: i32) -> Config {
        self.retries = retries
        self
    }

    // Non-builder method (void return) - should generate: pub fn apply(&self)
    pub fn apply(self) {
        println!("Applying config: {}", self.name)
    }
}

pub struct Person {
    pub first_name: String,
    pub last_name: String,
    pub age: i32,
}

impl Person {
    pub fn new() -> Person {
        Person {
            first_name: String::new(),
            last_name: String::new(),
            age: 0,
        }
    }

    // Builder pattern chain
    pub fn first_name(self, name: String) -> Person {
        self.first_name = name
        self
    }

    pub fn last_name(self, name: String) -> Person {
        self.last_name = name
        self
    }

    pub fn age(self, age: i32) -> Person {
        self.age = age
        self
    }
}

pub fn main() {
    // Builder pattern usage
    let config = Config::new()
        .name("MyApp".to_string())
        .timeout(60)
        .retries(5);

    println!("Config: {} (timeout: {}, retries: {})",
        config.name, config.timeout, config.retries);

    // Chained builder
    let person = Person::new()
        .first_name("John".to_string())
        .last_name("Doe".to_string())
        .age(30);

    println!("Person: {} {} (age: {})",
        person.first_name, person.last_name, person.age);
}

