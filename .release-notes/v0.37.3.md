# Windjammer v0.37.3 Release Notes

**Release Date**: November 27, 2025

## ğŸ‰ Major Compiler Improvements

This release delivers critical fixes for builder patterns and parameter ownership inference, enabling `windjammer-ui` to compile successfully with 0 errors!

## âœ¨ New Features

### Builder Pattern Support
- **Automatic `mut self` inference** for builder pattern methods
- Detects methods that modify fields AND return `self`
- Enables fluent API design without explicit ownership annotations
- Example:
  ```windjammer
  pub fn set_value(value: string) -> Builder {
      self.value = value
      self  // âœ… Correctly infers `mut self` (consuming)
  }
  ```

### Enhanced Parameter Ownership Inference
- **Struct literal support** in ownership analysis
- Parameters used in struct initialization now correctly inferred as owned
- Fixes patterns like `self.items.push(Item { label, href })`
- No more `&String` when you need `String`!

## ğŸ› Bug Fixes

### Compiler
- **Builder Pattern**: Fixed implicit `self` parameter inference for methods that modify fields and return `self`
  - Previously generated `&mut self` (borrowed), now correctly generates `mut self` (owned)
  - Added `function_returns_self_type()` to detect builder patterns in codegen
  - Enhanced field mutation detection to include method calls (`push`, `insert`, `extend`, etc.)
- **Parameter Ownership**: Fixed parameters in struct literals being incorrectly inferred as borrowed
  - Added `StructLiteral` case to `expression_uses_identifier()`
  - Now correctly detects when parameters are stored in struct fields
  - Fixes: `Item { label, href }` now infers `label: String, href: String` instead of `&String`

### CI/CD
- **Docker**: Fixed build failure due to missing benchmark directory
  - Created dummy `benches/salsa_performance.rs` for dependency caching layer
- **CodeQL**: Removed conflicting custom workflow
  - GitHub's default CodeQL setup now handles Rust analysis automatically
- **Code Coverage**: Increased tarpaulin timeout from 120s to 300s
  - Prevents timeout failures on slower CI runners

## ğŸ“Š Impact

### Dogfooding Success
- **`windjammer-ui` build errors**: 157 â†’ 0 âœ…
- Validates Windjammer's ability to build sophisticated libraries
- Unblocks `windjammer-ui` v0.3.0 type-safe API redesign

### Developer Experience
- âœ… Builder patterns work seamlessly without manual ownership annotations
- âœ… Struct initialization correctly infers parameter ownership
- âœ… Cleaner, more intuitive code generation
- âœ… Fewer compiler errors, faster development

## ğŸ”§ Technical Details

### Builder Pattern Detection Algorithm
1. Check if method modifies struct fields (assignments or mutating method calls)
2. Check if method returns custom type (struct)
3. Check if last statement returns `self` identifier
4. If all true â†’ use `mut self` (consuming), else `&mut self` (borrowing)

### Parameter Ownership Analysis
- Enhanced `is_stored()` to recursively check struct literal fields
- `expression_uses_identifier()` now handles:
  - Direct identifiers
  - Binary/unary operations
  - Method calls and function calls
  - Field access
  - **NEW**: Struct literals with field expressions

## ğŸ“¦ Installation

```bash
cargo install windjammer --version 0.37.3
```

Or update your `Cargo.toml`:
```toml
[dependencies]
windjammer = "0.37.3"
```

## ğŸ”— Links

- **GitHub Release**: https://github.com/jeffreyfriedman/windjammer/releases/tag/v0.37.3
- **Crates.io**: https://crates.io/crates/windjammer/0.37.3
- **Documentation**: https://docs.rs/windjammer/0.37.3
- **Changelog**: https://github.com/jeffreyfriedman/windjammer/blob/main/CHANGELOG.md

## ğŸ™ Acknowledgments

This release was driven by dogfooding efforts with `windjammer-ui`, demonstrating the power of using Windjammer to build its own ecosystem. The compiler improvements directly resulted from real-world usage patterns.

## ğŸš€ What's Next

- Continue `windjammer-ui` v0.3.0 development with type-safe API
- Expand Windjammer standard library
- Improve error messages and diagnostics
- Performance optimizations

---

**Full Changelog**: https://github.com/jeffreyfriedman/windjammer/compare/v0.37.2...v0.37.3

