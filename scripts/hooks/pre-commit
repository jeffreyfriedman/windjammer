#!/bin/bash
# Windjammer pre-commit hook
# Runs formatter, linter, and tests before allowing a commit
#
# Install this hook by running: ./scripts/install-hooks.sh

set -e

echo "🔍 Running pre-commit checks..."
echo ""

# 1. Run formatter
echo "📝 Running cargo fmt..."
if ! cargo fmt --all -- --check; then
    echo "❌ Formatting check failed!"
    echo "   Run 'cargo fmt --all' to fix formatting issues."
    exit 1
fi
echo "✅ Formatting check passed"
echo ""

# 2. Run linter
echo "🔎 Running cargo clippy..."
if ! cargo clippy --all-targets --all-features -- -D warnings 2>&1 | grep -q "Finished"; then
    echo "❌ Clippy check failed!"
    echo "   Fix linter warnings before committing."
    exit 1
fi
echo "✅ Clippy check passed"
echo ""

# 3. Run tests
echo "🧪 Running cargo test..."
if ! cargo test --quiet 2>&1 | tail -5 | grep -q "test result: ok"; then
    echo "❌ Tests failed!"
    echo "   Fix failing tests before committing."
    exit 1
fi
echo "✅ All tests passed"
echo ""

echo "✅ All pre-commit checks passed!"
echo "   Proceeding with commit..."
echo ""

